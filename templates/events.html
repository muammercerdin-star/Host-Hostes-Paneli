<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hesap â€” Sefer Kasa</title>
<style>
body{font-family:system-ui,-apple-system,Roboto;background:#0b1115;color:#e6edf3;margin:0}
.container{max-width:920px;margin:auto;padding:16px}
.card{background:#11171c;border:1px solid #22303a;border-radius:12px;padding:14px;margin:10px 0}
h1{font-size:20px;font-weight:700;margin:6px 0 10px}
label{font-size:12px;opacity:.8}
input,select,button,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #2a3946;background:#0b1217;color:#e6edf3}
textarea{min-height:80px;resize:vertical}
button.primary{background:#1f6b2d;border-color:#2a7b3a;font-weight:700}
button.danger{background:#7b1f1f;border-color:#8a2a2a}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.kasa{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:12px}
.kasa .box{background:#0f161b;border:1px solid #22303a;border-radius:10px;padding:8px;text-align:center}
.kasa .num{font-size:18px;font-weight:700}
.badge{display:inline-block;background:#25313b;border:1px solid #33414d;color:#c8d1d9;padding:4px 8px;border-radius:999px;font-size:12px;margin-right:6px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #22303a;padding:6px;text-align:left}
.footerbar{position:sticky;bottom:0;background:#0b1115;border-top:1px solid #22303a;padding:8px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.small{font-size:12px;opacity:.75}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ§¾ Hesap / Aktif Sefer</h1>

  <div class="card">
    <div class="kasa">
      <div class="box"><div>BaÅŸlangÄ±Ã§ (Devir)</div><div class="num">{{ sums.devir|tl }}</div></div>
      <div class="box"><div>Toplam GiriÅŸ</div><div class="num">{{ sums.giris|tl }}</div></div>
      <div class="box"><div>Toplam Ã‡Ä±kÄ±ÅŸ</div><div class="num">{{ sums.cikis|tl }}</div></div>
      <div class="box"><div>Kalan</div><div class="num">{{ sums.kalan|tl }}</div></div>
    </div>
    <div class="small">
      {% if trip.route %}<span class="badge">Hat: {{ trip.route }}</span>{% endif %}
      {% if trip.date %}<span class="badge">Tarih: {{ trip.date }}</span>{% endif %}
      {% if trip.departure_time %}<span class="badge">KalkÄ±ÅŸ: {{ trip.departure_time }}</span>{% endif %}
    </div>
  </div>

  <div class="grid3">
    <!-- DEVÄ°R -->
    <form class="card" method="post" action="{{ url_for('hesap_devir') }}">
      <h1>â¬†ï¸ Devir (BaÅŸlangÄ±Ã§)</h1>
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <div>
        <label>Tutar (TL)</label>
        <input type="number" name="amount" inputmode="numeric" min="0" placeholder="Ã¶rn. 5000" required>
      </div>
      <div>
        <label>Not (opsiyonel)</label>
        <input type="text" name="note" placeholder="Garaj avansÄ±">
      </div>
      <button class="primary" style="margin-top:8px">Kaydet</button>
      <div class="small" style="margin-top:6px">Not: Devir giriÅŸ olarak kaydedilir.</div>
    </form>

    <!-- GÄ°RÄ°Å -->
    <form class="card" method="post" action="{{ url_for('hesap_giris') }}">
      <h1>â• GiriÅŸ</h1>
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <div>
        <label>Kategori</label>
        <select name="category">
          {% for k in categories_in %}<option value="{{k}}">{{k}}</option>{% endfor %}
        </select>
      </div>
      <div>
        <label>Tutar (TL)</label>
        <input type="number" name="amount" inputmode="numeric" min="0" required>
      </div>
      <div>
        <label>AÃ§Ä±klama (opsiyonel)</label>
        <input type="text" name="note" placeholder="Ã¶rn. Harem hesabÄ±">
      </div>
      <button class="primary" style="margin-top:8px">Kaydet</button>
    </form>

    <!-- Ã‡IKIÅ -->
    <form class="card" method="post" action="{{ url_for('hesap_cikis') }}">
      <h1>â– Ã‡Ä±kÄ±ÅŸ</h1>
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <div>
        <label>Kategori</label>
        <select name="category">
          {% for k in categories_out %}<option value="{{k}}">{{k}}</option>{% endfor %}
        </select>
      </div>
      <div>
        <label>Tutar (TL)</label>
        <input type="number" name="amount" inputmode="numeric" min="0" required>
      </div>
      <div>
        <label>AÃ§Ä±klama (opsiyonel)</label>
        <input type="text" name="note" placeholder="Ã¶rn. YÄ±kama">
      </div>
      <button class="primary" style="margin-top:8px">Kaydet</button>
    </form>
  </div>

  <!-- KATEGORÄ°LERÄ° DÃœZENLE -->
  <form class="card" method="post" action="{{ url_for('hesap_kategoriler_kaydet') }}">
    <h1>âš™ï¸ Kategoriler</h1>
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <div class="grid2">
      <div>
        <label>GiriÅŸ Kategorileri (virgÃ¼l veya satÄ±r satÄ±r)</label>
        <textarea name="cats_in" placeholder="Devir, Garaj, Harem, EÅŸya, Nakit Bilet, Avans, DiÄŸer">{{ categories_in|join(', ') }}</textarea>
      </div>
      <div>
        <label>Ã‡Ä±kÄ±ÅŸ Kategorileri (virgÃ¼l veya satÄ±r satÄ±r)</label>
        <textarea name="cats_out" placeholder="YÄ±kama, Sigara, Yemek, Otoyol, Otogar, Ä°kram, Temizlik, Su/Ã‡ay, BakÄ±m, DiÄŸer">{{ categories_out|join(', ') }}</textarea>
      </div>
    </div>
    <div style="margin-top:8px">
      <button class="primary">Kaydet</button>
      <span class="small" style="margin-left:8px">BoÅŸ bÄ±rakÄ±rsan varsayÄ±lana dÃ¶ner.</span>
    </div>
  </form>

  <div class="card">
    <h1>ğŸ“‹ Son Hareketler</h1>
    <table class="table">
      <thead>
        <tr><th>Saat</th><th>YÃ¶n</th><th>Kategori</th><th>AÃ§Ä±klama</th><th>Tutar</th></tr>
      </thead>
      <tbody>
        {% for m in moves %}
          <tr>
            <td>{{ m.created_at }}</td>
            <td>{{ '+' if m.direction == '+' else '-' }}</td>
            <td>{{ m.category }}</td>
            <td>{{ m.note }}</td>
            <td>{{ m.amount|tl }}</td>
          </tr>
        {% else %}
          <tr><td colspan="5" class="small">HenÃ¼z hareket yok.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="footerbar">
    <a href="{{ url_for('seats') }}"><button>Biletler</button></a>
    <a href="{{ url_for('consignments_page') }}"><button>Emanet</button></a>
    <a href="{{ url_for('hesap_page') }}"><button class="primary">Hesap</button></a>
    <form method="post" action="{{ url_for('end_trip') }}" style="margin:0">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <button class="danger">Seferi Bitir</button>
    </form>
  </div>
</div>
</body>
</html>
