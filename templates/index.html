{%extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="/static/style.css">
<style>
  .wrap{max-width:980px;margin:22px auto}
  .panel{background:#2b3036;color:#e6edf3;border-radius:18px;padding:18px 18px 26px;box-shadow:0 6px 18px rgba(0,0,0,.35)}

  /* Şık rozet şeklinde hat seçimi */
  .route-select{position:relative;display:inline-block;margin:6px 4px 16px}
  .route-badge{
    display:inline-flex;align-items:center;gap:10px;
    background:#3a4047;border:1px solid #46505a;color:#fff;
    padding:10px 14px;border-radius:14px;font-weight:800
  }
  .route-badge .caret{font-weight:900;opacity:.85}
  /* görünmez select; rozete tıklayınca açılır */
  .route-select select{
    position:absolute;inset:0;opacity:0;width:100%;height:100%;cursor:pointer
  }

  /* Kart ızgarası */
  .grid{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr))}
  @media (min-width: 720px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr))} }
  .card{background:#3a4047;border:1px solid #46505a;border-radius:16px;padding:14px 16px;text-decoration:none;color:#e6edf3;display:block;min-height:92px}
  .card:hover{filter:brightness(1.06)}
  .card.blue{background:#0d6efd;border-color:#0b5ed7}
  .title{font-weight:800;font-size:17px;margin-bottom:4px}
  .desc{opacity:.85;font-size:14px}

  .lock{margin-top:16px}
  .lock button{
    appearance:none;background:#3a4047;border:1px solid #46505a;color:#fff;
    padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer
  }
</style>

<div class="wrap">
  <div class="panel">
    <!-- Şık rozetli hat seçimi -->
    <div class="route-select">
      <div class="route-badge">
        <span id="routeText">{{ current_route }}</span>
        <span class="caret">▾</span>
      </div>
      <select onchange="changeRoute(this.value)">
        {% for r in all_routes %}
          <option value="{{ r }}" {{ 'selected' if r==current_route else '' }}>{{ r }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="grid">
      <a class="card" href="{{ url_for('trip_start') }}">
        <div class="title">SEFER BAŞLAT</div>
        <div class="desc">Yeni sefer başlat</div>
      </a>

      <a class="card" href="{{ url_for('continue_trip') }}">
        <div class="title">DEVAM EDEN SEFER</div>
        <div class="desc">Aktif sefer varsa koltuklara git</div>
      </a>

      <a class="card" href="{{ url_for('seats') }}">
        <div class="title">HIZLI KOLTUK</div>
        <div class="desc">Koltuk ekranına git</div>
      </a>

      <a class="card" href="{{ url_for('passenger_control') }}">
        <div class="title">YOLCU KONTROLÜ</div>
        <div class="desc">Koltuk kontrol ekranı</div>
      </a>

      <a class="card" href="{{ url_for('reports_page') }}">
        <div class="title">RAPORLAR</div>
        <div class="desc">Koltuk satış raporları ve gelir analizi</div>
     </a>

      <a class="card" href="{{ url_for('consignments_page') }}">
        <div class="title">EMANETLER</div>
        <div class="desc">Emanet kayıt ve teslim işlemleri</div>
      </a>

      <a class="card" href="{{ url_for('events_page') }}">
        <div class="title">OLAYLAR</div>
        <div class="desc">Sefer olay geçmişi / log kayıtları</div>
     </a>
      <a class="card blue" href="{{ url_for('add_route') }}">
        <div class="title">HAT EKLE</div>
        <div class="desc">Yeni hat ve durakları tanımla</div>
      </a>

      <a class="card" href="{{ url_for('routes_list') }}">
        <div class="title">HATLAR</div>
        <div class="desc">Hatları listele / düzenle</div>
      </a>

      <a class="card" href="{{ url_for('fare_query') }}">
        <div class="title">FİYAT SORGU</div>
        <div class="desc">Biniş/iniş seç, fiyatı gör</div>
      </a>
    </div>

    <!-- SADECE BİR KİLİTLE BUTONU -->
    <div class="lock">
      <form method="post" action="{{ url_for('logout') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button type="submit">KİLİTLE</button>
      </form>
    </div>
  </div>
</div>

<script>
  const csrf = "{{ csrf_token }}";
  async function changeRoute(route){
    try{
      const res = await fetch('{{ url_for("set_route") }}', {
        method:'POST',
        headers:{'Content-Type':'application/json','X-CSRF-Token':csrf},
        body: JSON.stringify({route})
      });
      const j = await res.json();
      if(!j.ok){ alert(j.msg || 'Hata'); return; }
      document.getElementById('routeText').textContent = route;
      // İstersen sayfayı tazele: location.reload();
    }catch(e){
      alert('Bağlantı hatası');
    }
  }
</script>
{% endblock %}
